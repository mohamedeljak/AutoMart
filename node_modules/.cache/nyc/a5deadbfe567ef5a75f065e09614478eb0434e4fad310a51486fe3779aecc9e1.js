"use strict";var cov_2csg0ikj41=function(){var path="/home/mhashim/Desktop/NewWork/AutoMart/src/middlewares/authenticonAdmin.js";var hash="a0d2950b27c99e93a65f2bb5c13a5a801007ed32";var global=new Function("return this")();var gcv="__coverage__";var coverageData={path:"/home/mhashim/Desktop/NewWork/AutoMart/src/middlewares/authenticonAdmin.js",statementMap:{"0":{start:{line:3,column:15},end:{line:3,column:57}},"1":{start:{line:5,column:18},end:{line:5,column:78}},"2":{start:{line:7,column:12},end:{line:7,column:66}},"3":{start:{line:9,column:20},end:{line:9,column:67}},"4":{start:{line:11,column:13},end:{line:11,column:62}},"5":{start:{line:13,column:39},end:{line:13,column:93}},"6":{start:{line:16,column:12},end:{line:16,column:28}},"7":{start:{line:18,column:12},end:{line:18,column:35}},"8":{start:{line:19,column:0},end:{line:19,column:33}},"9":{start:{line:21,column:0},end:{line:84,column:2}},"10":{start:{line:23,column:14},end:{line:23,column:41}},"11":{start:{line:25,column:21},end:{line:25,column:88}},"12":{start:{line:25,column:64},end:{line:25,column:87}},"13":{start:{line:29,column:2},end:{line:83,column:3}},"14":{start:{line:32,column:4},end:{line:73,column:7}},"15":{start:{line:34,column:6},end:{line:72,column:7}},"16":{start:{line:36,column:8},end:{line:42,column:11}},"17":{start:{line:44,column:8},end:{line:71,column:9}},"18":{start:{line:45,column:33},end:{line:45,column:105}},"19":{start:{line:45,column:76},end:{line:45,column:104}},"20":{start:{line:47,column:10},end:{line:47,column:64}},"21":{start:{line:49,column:10},end:{line:62,column:11}},"22":{start:{line:52,column:12},end:{line:52,column:34}},"23":{start:{line:53,column:12},end:{line:53,column:19}},"24":{start:{line:55,column:12},end:{line:61,column:15}},"25":{start:{line:64,column:10},end:{line:70,column:13}},"26":{start:{line:76,column:4},end:{line:82,column:7}}},fnMap:{"0":{name:"_interopRequireDefault",decl:{start:{line:13,column:9},end:{line:13,column:31}},loc:{start:{line:13,column:37},end:{line:13,column:95}},line:13},"1":{name:"(anonymous_1)",decl:{start:{line:21,column:17},end:{line:21,column:18}},loc:{start:{line:21,column:37},end:{line:84,column:1}},line:21},"2":{name:"(anonymous_2)",decl:{start:{line:25,column:53},end:{line:25,column:54}},loc:{start:{line:25,column:64},end:{line:25,column:87}},line:25},"3":{name:"(anonymous_3)",decl:{start:{line:32,column:54},end:{line:32,column:55}},loc:{start:{line:32,column:72},end:{line:73,column:5}},line:32},"4":{name:"(anonymous_4)",decl:{start:{line:45,column:65},end:{line:45,column:66}},loc:{start:{line:45,column:76},end:{line:45,column:104}},line:45}},branchMap:{"0":{loc:{start:{line:13,column:46},end:{line:13,column:92}},type:"cond-expr",locations:[{start:{line:13,column:70},end:{line:13,column:73}},{start:{line:13,column:76},end:{line:13,column:92}}],line:13},"1":{loc:{start:{line:13,column:46},end:{line:13,column:67}},type:"binary-expr",locations:[{start:{line:13,column:46},end:{line:13,column:49}},{start:{line:13,column:53},end:{line:13,column:67}}],line:13},"2":{loc:{start:{line:29,column:2},end:{line:83,column:3}},type:"if",locations:[{start:{line:29,column:2},end:{line:83,column:3}},{start:{line:29,column:2},end:{line:83,column:3}}],line:29},"3":{loc:{start:{line:34,column:6},end:{line:72,column:7}},type:"if",locations:[{start:{line:34,column:6},end:{line:72,column:7}},{start:{line:34,column:6},end:{line:72,column:7}}],line:34},"4":{loc:{start:{line:44,column:8},end:{line:71,column:9}},type:"if",locations:[{start:{line:44,column:8},end:{line:71,column:9}},{start:{line:44,column:8},end:{line:71,column:9}}],line:44},"5":{loc:{start:{line:49,column:10},end:{line:62,column:11}},type:"if",locations:[{start:{line:49,column:10},end:{line:62,column:11}},{start:{line:49,column:10},end:{line:62,column:11}}],line:49}},s:{"0":0,"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0,"18":0,"19":0,"20":0,"21":0,"22":0,"23":0,"24":0,"25":0,"26":0},f:{"0":0,"1":0,"2":0,"3":0,"4":0},b:{"0":[0,0],"1":[0,0],"2":[0,0],"3":[0,0],"4":[0,0],"5":[0,0]},_coverageSchema:"43e27e138ebf9cfc5966b082cf9a028302ed4184",hash:"a0d2950b27c99e93a65f2bb5c13a5a801007ed32"};var coverage=global[gcv]||(global[gcv]={});if(coverage[path]&&coverage[path].hash===hash){return coverage[path];}return coverage[path]=coverageData;}();var _express=(cov_2csg0ikj41.s[0]++,_interopRequireDefault(require("express")));var _Reflection=(cov_2csg0ikj41.s[1]++,_interopRequireDefault(require("../controllers/Reflection")));var _user=(cov_2csg0ikj41.s[2]++,_interopRequireDefault(require("../controllers/user")));var _jsonwebtoken=(cov_2csg0ikj41.s[3]++,_interopRequireDefault(require("jsonwebtoken")));var _user2=(cov_2csg0ikj41.s[4]++,_interopRequireDefault(require("../models/user")));function _interopRequireDefault(obj){cov_2csg0ikj41.f[0]++;cov_2csg0ikj41.s[5]++;return(cov_2csg0ikj41.b[1][0]++,obj)&&(cov_2csg0ikj41.b[1][1]++,obj.__esModule)?(cov_2csg0ikj41.b[0][0]++,obj):(cov_2csg0ikj41.b[0][1]++,{default:obj});}//import tokenkey from './key';
const key=(cov_2csg0ikj41.s[6]++,require('./key'));const app=(cov_2csg0ikj41.s[7]++,(0,_express.default)());cov_2csg0ikj41.s[8]++;app.use(_express.default.json());//app.use('/api/v1/car', ProtectedRoutes);
cov_2csg0ikj41.s[9]++;module.exports=(req,res,next)=>{cov_2csg0ikj41.f[1]++;// check header for the token
var token=(cov_2csg0ikj41.s[10]++,req.headers['access-token']);const reflection=(cov_2csg0ikj41.s[11]++,_user2.default.reflections.find(reflect=>{cov_2csg0ikj41.f[2]++;cov_2csg0ikj41.s[12]++;return reflect.token===token;}));//console.log("is_admin==="+reflection.id);
// decode token
cov_2csg0ikj41.s[13]++;if(token){cov_2csg0ikj41.b[2][0]++;cov_2csg0ikj41.s[14]++;//console.log(key.tokenkey)
// verifies secret and checks if the token is expired
_jsonwebtoken.default.verify(token,key.tokenkey,(err,decoded)=>{cov_2csg0ikj41.f[3]++;cov_2csg0ikj41.s[15]++;//console.log('-----------------------',err)
if(err){cov_2csg0ikj41.b[3][0]++;cov_2csg0ikj41.s[16]++;//console.log(token);
return res.json({status:400,message:"invalid token",data:{message:'invalid token'}});}else{cov_2csg0ikj41.b[3][1]++;cov_2csg0ikj41.s[17]++;if(reflection){cov_2csg0ikj41.b[4][0]++;const reflectionuser=(cov_2csg0ikj41.s[18]++,_user2.default.reflections.find(reflect=>{cov_2csg0ikj41.f[4]++;cov_2csg0ikj41.s[19]++;return reflect.id===reflection.id;}));cov_2csg0ikj41.s[20]++;console.log("iffffffff== "+reflectionuser.is_admin);cov_2csg0ikj41.s[21]++;if(reflectionuser.is_admin===true){cov_2csg0ikj41.b[5][0]++;cov_2csg0ikj41.s[22]++;//  console.log("is_admin==="+reflection);
// if everything is good, save to request for use in other routes
req.decoded=decoded;cov_2csg0ikj41.s[23]++;next();}else{cov_2csg0ikj41.b[5][1]++;cov_2csg0ikj41.s[24]++;return res.json({status:400,message:"your are not admin",data:{message:' your are not admin'}});}}else{cov_2csg0ikj41.b[4][1]++;cov_2csg0ikj41.s[25]++;return res.json({status:400,message:"User not Found",data:{message:' User not Found'}});}}});}else{cov_2csg0ikj41.b[2][1]++;cov_2csg0ikj41.s[26]++;// if there is no token  
res.send({status:401,message:"token not provided",data:{message:'No token provided.'}});}};//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImF1dGhlbnRpY29uQWRtaW4uanMiXSwibmFtZXMiOlsia2V5IiwicmVxdWlyZSIsImFwcCIsInVzZSIsImV4cHJlc3MiLCJqc29uIiwibW9kdWxlIiwiZXhwb3J0cyIsInJlcSIsInJlcyIsIm5leHQiLCJ0b2tlbiIsImhlYWRlcnMiLCJyZWZsZWN0aW9uIiwidXNlcngiLCJyZWZsZWN0aW9ucyIsImZpbmQiLCJyZWZsZWN0Iiwiand0IiwidmVyaWZ5IiwidG9rZW5rZXkiLCJlcnIiLCJkZWNvZGVkIiwic3RhdHVzIiwibWVzc2FnZSIsImRhdGEiLCJyZWZsZWN0aW9udXNlciIsImlkIiwiY29uc29sZSIsImxvZyIsImlzX2FkbWluIiwic2VuZCJdLCJtYXBwaW5ncyI6Ijs7QUFBQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7OztBQUNBO0FBR0EsTUFBTUEsR0FBRyxHQUFHQyxPQUFPLENBQUMsT0FBRCxDQUFuQjs7QUFFQSxNQUFNQyxHQUFHLEdBQUcsdUJBQVo7QUFDQUEsR0FBRyxDQUFDQyxHQUFKLENBQVFDLGlCQUFRQyxJQUFSLEVBQVIsRSxDQUlBOztBQUNBQyxNQUFNLENBQUNDLE9BQVAsR0FBaUIsQ0FBQ0MsR0FBRCxFQUFNQyxHQUFOLEVBQVdDLElBQVgsS0FBb0I7QUFHakM7QUFDQSxNQUFJQyxLQUFLLEdBQUdILEdBQUcsQ0FBQ0ksT0FBSixDQUFZLGNBQVosQ0FBWjs7QUFDQSxRQUFNQyxVQUFVLEdBQUdDLGVBQU1DLFdBQU4sQ0FBa0JDLElBQWxCLENBQXVCQyxPQUFPLElBQUlBLE9BQU8sQ0FBQ04sS0FBUixLQUFrQkEsS0FBcEQsQ0FBbkIsQ0FMaUMsQ0FPakM7QUFDQTs7O0FBQ0EsTUFBSUEsS0FBSixFQUFXO0FBQ1Y7QUFDQztBQUNBTywwQkFBSUMsTUFBSixDQUFXUixLQUFYLEVBQWtCWCxHQUFHLENBQUNvQixRQUF0QixFQUFpQyxDQUFDQyxHQUFELEVBQU1DLE9BQU4sS0FBaUI7QUFDbEQ7QUFDRSxVQUFJRCxHQUFKLEVBQVM7QUFDUjtBQUNDLGVBQU9aLEdBQUcsQ0FBQ0osSUFBSixDQUFTO0FBQ2ZrQixVQUFBQSxNQUFNLEVBQUUsR0FETztBQUVuQkMsVUFBQUEsT0FBTyxFQUFFLGVBRlU7QUFHbkJDLFVBQUFBLElBQUksRUFBRTtBQUVGRCxZQUFBQSxPQUFPLEVBQUU7QUFGUDtBQUhhLFNBQVQsQ0FBUDtBQU1ELE9BUkQsTUFRTztBQUNOLFlBQUdYLFVBQUgsRUFBZTtBQUNkLGdCQUFNYSxjQUFjLEdBQUdaLGVBQU1DLFdBQU4sQ0FBa0JDLElBQWxCLENBQXVCQyxPQUFPLElBQUlBLE9BQU8sQ0FBQ1UsRUFBUixLQUFlZCxVQUFVLENBQUNjLEVBQTVELENBQXZCOztBQUNDQyxVQUFBQSxPQUFPLENBQUNDLEdBQVIsQ0FBWSxpQkFBZUgsY0FBYyxDQUFDSSxRQUExQzs7QUFDRCxjQUFHSixjQUFjLENBQUNJLFFBQWYsS0FBNEIsSUFBL0IsRUFBb0M7QUFDcEM7QUFDQTtBQUNBdEIsWUFBQUEsR0FBRyxDQUFDYyxPQUFKLEdBQWNBLE9BQWQ7QUFDQVosWUFBQUEsSUFBSTtBQUNMLFdBTEMsTUFNRztBQUNILG1CQUFPRCxHQUFHLENBQUNKLElBQUosQ0FBUztBQUNma0IsY0FBQUEsTUFBTSxFQUFFLEdBRE87QUFFbEJDLGNBQUFBLE9BQU8sRUFBRSxvQkFGUztBQUdsQkMsY0FBQUEsSUFBSSxFQUFFO0FBRUZELGdCQUFBQSxPQUFPLEVBQUU7QUFGUDtBQUhZLGFBQVQsQ0FBUDtBQVFEO0FBQ0YsU0FuQkUsTUFvQkM7QUFFSCxpQkFBT2YsR0FBRyxDQUFDSixJQUFKLENBQVM7QUFDWmtCLFlBQUFBLE1BQU0sRUFBRSxHQURJO0FBRWZDLFlBQUFBLE9BQU8sRUFBRSxnQkFGTTtBQUdmQyxZQUFBQSxJQUFJLEVBQUU7QUFFRkQsY0FBQUEsT0FBTyxFQUFFO0FBRlA7QUFIUyxXQUFULENBQVA7QUFPRDtBQUVHO0FBQ0YsS0EzQ0Q7QUE2Q0QsR0FoREQsTUFnRE87QUFFTDtBQUVBZixJQUFBQSxHQUFHLENBQUNzQixJQUFKLENBQVM7QUFDUlIsTUFBQUEsTUFBTSxFQUFFLEdBREE7QUFFUkMsTUFBQUEsT0FBTyxFQUFFLG9CQUZEO0FBR1JDLE1BQUFBLElBQUksRUFBRTtBQUVIRCxRQUFBQSxPQUFPLEVBQUU7QUFGTjtBQUhFLEtBQVQ7QUFRRDtBQUNGLENBdEVIIiwic291cmNlUm9vdCI6Ii9ob21lL21oYXNoaW0vRGVza3RvcC9OZXdXb3JrL0F1dG9NYXJ0L3NyYy9taWRkbGV3YXJlcyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBleHByZXNzIGZyb20gJ2V4cHJlc3MnO1xuaW1wb3J0IFJlZmxlY3Rpb24gZnJvbSAnLi4vY29udHJvbGxlcnMvUmVmbGVjdGlvbic7XG5pbXBvcnQgdXNlciBmcm9tICcuLi9jb250cm9sbGVycy91c2VyJztcbmltcG9ydCBqd3QgZnJvbSAnanNvbndlYnRva2VuJztcbmltcG9ydCB1c2VyeCBmcm9tICcuLi9tb2RlbHMvdXNlcic7XG4vL2ltcG9ydCB0b2tlbmtleSBmcm9tICcuL2tleSc7XG5cblxuY29uc3Qga2V5ID0gcmVxdWlyZSgnLi9rZXknKTtcblxuY29uc3QgYXBwID0gZXhwcmVzcygpXG5hcHAudXNlKGV4cHJlc3MuanNvbigpKVxuXG5cblxuLy9hcHAudXNlKCcvYXBpL3YxL2NhcicsIFByb3RlY3RlZFJvdXRlcyk7XG5tb2R1bGUuZXhwb3J0cyA9IChyZXEsIHJlcywgbmV4dCkgPT4ge1xuXG5cbiAgICAvLyBjaGVjayBoZWFkZXIgZm9yIHRoZSB0b2tlblxuICAgIHZhciB0b2tlbiA9IHJlcS5oZWFkZXJzWydhY2Nlc3MtdG9rZW4nXTtcbiAgICBjb25zdCByZWZsZWN0aW9uID0gdXNlcngucmVmbGVjdGlvbnMuZmluZChyZWZsZWN0ID0+IHJlZmxlY3QudG9rZW4gPT09IHRva2VuKTtcblxuICAgIC8vY29uc29sZS5sb2coXCJpc19hZG1pbj09PVwiK3JlZmxlY3Rpb24uaWQpO1xuICAgIC8vIGRlY29kZSB0b2tlblxuICAgIGlmICh0b2tlbikge1xuICAgICAvL2NvbnNvbGUubG9nKGtleS50b2tlbmtleSlcbiAgICAgIC8vIHZlcmlmaWVzIHNlY3JldCBhbmQgY2hlY2tzIGlmIHRoZSB0b2tlbiBpcyBleHBpcmVkXG4gICAgICBqd3QudmVyaWZ5KHRva2VuLCBrZXkudG9rZW5rZXkgLCAoZXJyLCBkZWNvZGVkKSA9PnsgIFxuICAgICAgLy9jb25zb2xlLmxvZygnLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0nLGVycilcbiAgICAgICAgaWYgKGVycikge1xuICAgICAgICBcdC8vY29uc29sZS5sb2codG9rZW4pO1xuICAgICAgICAgIHJldHVybiByZXMuanNvbih7IFxuICAgICAgICAgICBzdGF0dXMgOjQwMCxcbiAgICAgIFx0bWVzc2FnZSA6XCJpbnZhbGlkIHRva2VuXCIsXG4gICAgICBcdGRhdGE6IHsgIFxuXG4gICAgICAgICAgXHRtZXNzYWdlOiAnaW52YWxpZCB0b2tlbicgfSB9KTsgICAgXG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICBpZihyZWZsZWN0aW9uKSB7XG4gICAgICAgICAgY29uc3QgcmVmbGVjdGlvbnVzZXIgPSB1c2VyeC5yZWZsZWN0aW9ucy5maW5kKHJlZmxlY3QgPT4gcmVmbGVjdC5pZCA9PT0gcmVmbGVjdGlvbi5pZCk7XG4gICAgICAgICAgIGNvbnNvbGUubG9nKFwiaWZmZmZmZmZmPT0gXCIrcmVmbGVjdGlvbnVzZXIuaXNfYWRtaW4pO1xuICAgICAgICAgIGlmKHJlZmxlY3Rpb251c2VyLmlzX2FkbWluID09PSB0cnVlKXtcbiAgICAgICAgICAvLyAgY29uc29sZS5sb2coXCJpc19hZG1pbj09PVwiK3JlZmxlY3Rpb24pO1xuICAgICAgICAgIC8vIGlmIGV2ZXJ5dGhpbmcgaXMgZ29vZCwgc2F2ZSB0byByZXF1ZXN0IGZvciB1c2UgaW4gb3RoZXIgcm91dGVzXG4gICAgICAgICAgcmVxLmRlY29kZWQgPSBkZWNvZGVkOyAgICBcbiAgICAgICAgICBuZXh0KCk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgcmV0dXJuIHJlcy5qc29uKHsgXG4gICAgICAgICAgIHN0YXR1cyA6NDAwLFxuICAgICAgICBtZXNzYWdlIDpcInlvdXIgYXJlIG5vdCBhZG1pblwiLFxuICAgICAgICBkYXRhOiB7ICBcblxuICAgICAgICAgICAgbWVzc2FnZTogJyB5b3VyIGFyZSBub3QgYWRtaW4nIH0gfSk7XG5cblxuICAgICAgICB9XG4gICAgICB9XG4gICAgIGVsc2Uge1xuXG4gICAgICAgcmV0dXJuIHJlcy5qc29uKHsgXG4gICAgICAgICAgIHN0YXR1cyA6NDAwLFxuICAgICAgICBtZXNzYWdlIDpcIlVzZXIgbm90IEZvdW5kXCIsXG4gICAgICAgIGRhdGE6IHsgIFxuXG4gICAgICAgICAgICBtZXNzYWdlOiAnIFVzZXIgbm90IEZvdW5kJyB9IH0pO1xuXG4gICAgIH1cblxuICAgICAgICB9XG4gICAgICB9KTtcblxuICAgIH0gZWxzZSB7XG5cbiAgICAgIC8vIGlmIHRoZXJlIGlzIG5vIHRva2VuICBcblxuICAgICAgcmVzLnNlbmQoeyBcbiAgICAgIFx0c3RhdHVzIDo0MDEsXG4gICAgICBcdG1lc3NhZ2UgOlwidG9rZW4gbm90IHByb3ZpZGVkXCIsXG4gICAgICBcdGRhdGE6IHsgIFxuXG4gICAgICAgICAgbWVzc2FnZTogJ05vIHRva2VuIHByb3ZpZGVkLid9IFxuICAgICAgfSk7XG5cbiAgICB9XG4gIH07XG4gIl19