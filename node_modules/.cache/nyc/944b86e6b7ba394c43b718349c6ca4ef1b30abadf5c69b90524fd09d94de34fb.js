"use strict";var cov_2csg0ikj41=function(){var path="/home/mhashim/Desktop/NewWork/AutoMart/src/middlewares/authenticonAdmin.js";var hash="04b702b66b5f3637fac5d7e8fd294d5d1139cf76";var global=new Function("return this")();var gcv="__coverage__";var coverageData={path:"/home/mhashim/Desktop/NewWork/AutoMart/src/middlewares/authenticonAdmin.js",statementMap:{"0":{start:{line:3,column:15},end:{line:3,column:57}},"1":{start:{line:5,column:18},end:{line:5,column:78}},"2":{start:{line:7,column:12},end:{line:7,column:66}},"3":{start:{line:9,column:20},end:{line:9,column:67}},"4":{start:{line:11,column:13},end:{line:11,column:62}},"5":{start:{line:13,column:39},end:{line:13,column:95}},"6":{start:{line:16,column:10},end:{line:16,column:26}},"7":{start:{line:18,column:10},end:{line:18,column:36}},"8":{start:{line:19,column:0},end:{line:19,column:36}},"9":{start:{line:21,column:0},end:{line:88,column:2}},"10":{start:{line:23,column:14},end:{line:23,column:41}},"11":{start:{line:25,column:19},end:{line:27,column:4}},"12":{start:{line:26,column:4},end:{line:26,column:35}},"13":{start:{line:31,column:2},end:{line:87,column:3}},"14":{start:{line:34,column:4},end:{line:77,column:7}},"15":{start:{line:36,column:6},end:{line:76,column:7}},"16":{start:{line:38,column:8},end:{line:44,column:11}},"17":{start:{line:46,column:8},end:{line:75,column:9}},"18":{start:{line:47,column:31},end:{line:49,column:12}},"19":{start:{line:48,column:12},end:{line:48,column:48}},"20":{start:{line:51,column:10},end:{line:51,column:64}},"21":{start:{line:53,column:10},end:{line:66,column:11}},"22":{start:{line:56,column:12},end:{line:56,column:34}},"23":{start:{line:57,column:12},end:{line:57,column:19}},"24":{start:{line:59,column:12},end:{line:65,column:15}},"25":{start:{line:68,column:10},end:{line:74,column:13}},"26":{start:{line:80,column:4},end:{line:86,column:7}}},fnMap:{"0":{name:"_interopRequireDefault",decl:{start:{line:13,column:9},end:{line:13,column:31}},loc:{start:{line:13,column:37},end:{line:13,column:97}},line:13},"1":{name:"(anonymous_1)",decl:{start:{line:21,column:17},end:{line:21,column:18}},loc:{start:{line:21,column:43},end:{line:88,column:1}},line:21},"2":{name:"(anonymous_2)",decl:{start:{line:25,column:54},end:{line:25,column:55}},loc:{start:{line:25,column:73},end:{line:27,column:3}},line:25},"3":{name:"(anonymous_3)",decl:{start:{line:34,column:57},end:{line:34,column:58}},loc:{start:{line:34,column:81},end:{line:77,column:5}},line:34},"4":{name:"(anonymous_4)",decl:{start:{line:47,column:66},end:{line:47,column:67}},loc:{start:{line:47,column:85},end:{line:49,column:11}},line:47}},branchMap:{"0":{loc:{start:{line:13,column:46},end:{line:13,column:94}},type:"cond-expr",locations:[{start:{line:13,column:70},end:{line:13,column:73}},{start:{line:13,column:76},end:{line:13,column:94}}],line:13},"1":{loc:{start:{line:13,column:46},end:{line:13,column:67}},type:"binary-expr",locations:[{start:{line:13,column:46},end:{line:13,column:49}},{start:{line:13,column:53},end:{line:13,column:67}}],line:13},"2":{loc:{start:{line:31,column:2},end:{line:87,column:3}},type:"if",locations:[{start:{line:31,column:2},end:{line:87,column:3}},{start:{line:31,column:2},end:{line:87,column:3}}],line:31},"3":{loc:{start:{line:36,column:6},end:{line:76,column:7}},type:"if",locations:[{start:{line:36,column:6},end:{line:76,column:7}},{start:{line:36,column:6},end:{line:76,column:7}}],line:36},"4":{loc:{start:{line:46,column:8},end:{line:75,column:9}},type:"if",locations:[{start:{line:46,column:8},end:{line:75,column:9}},{start:{line:46,column:8},end:{line:75,column:9}}],line:46},"5":{loc:{start:{line:53,column:10},end:{line:66,column:11}},type:"if",locations:[{start:{line:53,column:10},end:{line:66,column:11}},{start:{line:53,column:10},end:{line:66,column:11}}],line:53}},s:{"0":0,"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0,"18":0,"19":0,"20":0,"21":0,"22":0,"23":0,"24":0,"25":0,"26":0},f:{"0":0,"1":0,"2":0,"3":0,"4":0},b:{"0":[0,0],"1":[0,0],"2":[0,0],"3":[0,0],"4":[0,0],"5":[0,0]},_coverageSchema:"43e27e138ebf9cfc5966b082cf9a028302ed4184",hash:"04b702b66b5f3637fac5d7e8fd294d5d1139cf76"};var coverage=global[gcv]||(global[gcv]={});if(coverage[path]&&coverage[path].hash===hash){return coverage[path];}return coverage[path]=coverageData;}();var _express=(cov_2csg0ikj41.s[0]++,_interopRequireDefault(require("express")));var _Reflection=(cov_2csg0ikj41.s[1]++,_interopRequireDefault(require("../controllers/Reflection")));var _user=(cov_2csg0ikj41.s[2]++,_interopRequireDefault(require("../controllers/user")));var _jsonwebtoken=(cov_2csg0ikj41.s[3]++,_interopRequireDefault(require("jsonwebtoken")));var _user2=(cov_2csg0ikj41.s[4]++,_interopRequireDefault(require("../models/user")));function _interopRequireDefault(obj){cov_2csg0ikj41.f[0]++;cov_2csg0ikj41.s[5]++;return(cov_2csg0ikj41.b[1][0]++,obj)&&(cov_2csg0ikj41.b[1][1]++,obj.__esModule)?(cov_2csg0ikj41.b[0][0]++,obj):(cov_2csg0ikj41.b[0][1]++,{"default":obj});}//import tokenkey from './key';
var key=(cov_2csg0ikj41.s[6]++,require('./key'));var app=(cov_2csg0ikj41.s[7]++,(0,_express["default"])());cov_2csg0ikj41.s[8]++;app.use(_express["default"].json());//app.use('/api/v1/car', ProtectedRoutes);
cov_2csg0ikj41.s[9]++;module.exports=function(req,res,next){cov_2csg0ikj41.f[1]++;// check header for the token
var token=(cov_2csg0ikj41.s[10]++,req.headers['access-token']);var reflection=(cov_2csg0ikj41.s[11]++,_user2["default"].reflections.find(function(reflect){cov_2csg0ikj41.f[2]++;cov_2csg0ikj41.s[12]++;return reflect.token===token;}));//console.log("is_admin==="+reflection.id);
// decode token
cov_2csg0ikj41.s[13]++;if(token){cov_2csg0ikj41.b[2][0]++;cov_2csg0ikj41.s[14]++;//console.log(key.tokenkey)
// verifies secret and checks if the token is expired
_jsonwebtoken["default"].verify(token,key.tokenkey,function(err,decoded){cov_2csg0ikj41.f[3]++;cov_2csg0ikj41.s[15]++;//console.log('-----------------------',err)
if(err){cov_2csg0ikj41.b[3][0]++;cov_2csg0ikj41.s[16]++;//console.log(token);
return res.json({status:400,message:"invalid token",data:{message:'invalid token'}});}else{cov_2csg0ikj41.b[3][1]++;cov_2csg0ikj41.s[17]++;if(reflection){cov_2csg0ikj41.b[4][0]++;var reflectionuser=(cov_2csg0ikj41.s[18]++,_user2["default"].reflections.find(function(reflect){cov_2csg0ikj41.f[4]++;cov_2csg0ikj41.s[19]++;return reflect.id===reflection.id;}));cov_2csg0ikj41.s[20]++;console.log("iffffffff== "+reflectionuser.is_admin);cov_2csg0ikj41.s[21]++;if(reflectionuser.is_admin===true){cov_2csg0ikj41.b[5][0]++;cov_2csg0ikj41.s[22]++;//  console.log("is_admin==="+reflection);
// if everything is good, save to request for use in other routes
req.decoded=decoded;cov_2csg0ikj41.s[23]++;next();}else{cov_2csg0ikj41.b[5][1]++;cov_2csg0ikj41.s[24]++;return res.json({status:400,message:"your are not admin",data:{message:' your are not admin'}});}}else{cov_2csg0ikj41.b[4][1]++;cov_2csg0ikj41.s[25]++;return res.json({status:400,message:"User not Found",data:{message:' User not Found'}});}}});}else{cov_2csg0ikj41.b[2][1]++;cov_2csg0ikj41.s[26]++;// if there is no token  
res.send({status:401,message:"token not provided",data:{message:'No token provided.'}});}};//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImF1dGhlbnRpY29uQWRtaW4uanMiXSwibmFtZXMiOlsia2V5IiwicmVxdWlyZSIsImFwcCIsInVzZSIsImV4cHJlc3MiLCJqc29uIiwibW9kdWxlIiwiZXhwb3J0cyIsInJlcSIsInJlcyIsIm5leHQiLCJ0b2tlbiIsImhlYWRlcnMiLCJyZWZsZWN0aW9uIiwidXNlcngiLCJyZWZsZWN0aW9ucyIsImZpbmQiLCJyZWZsZWN0Iiwiand0IiwidmVyaWZ5IiwidG9rZW5rZXkiLCJlcnIiLCJkZWNvZGVkIiwic3RhdHVzIiwibWVzc2FnZSIsImRhdGEiLCJyZWZsZWN0aW9udXNlciIsImlkIiwiY29uc29sZSIsImxvZyIsImlzX2FkbWluIiwic2VuZCJdLCJtYXBwaW5ncyI6Ijs7QUFBQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7OztBQUNBO0FBR0EsSUFBTUEsR0FBRyxHQUFHQyxPQUFPLENBQUMsT0FBRCxDQUFuQjs7QUFFQSxJQUFNQyxHQUFHLEdBQUcsMEJBQVo7QUFDQUEsR0FBRyxDQUFDQyxHQUFKLENBQVFDLG9CQUFRQyxJQUFSLEVBQVIsRSxDQUlBOztBQUNBQyxNQUFNLENBQUNDLE9BQVAsR0FBaUIsVUFBQ0MsR0FBRCxFQUFNQyxHQUFOLEVBQVdDLElBQVgsRUFBb0I7QUFHakM7QUFDQSxNQUFJQyxLQUFLLEdBQUdILEdBQUcsQ0FBQ0ksT0FBSixDQUFZLGNBQVosQ0FBWjs7QUFDQSxNQUFNQyxVQUFVLEdBQUdDLGtCQUFNQyxXQUFOLENBQWtCQyxJQUFsQixDQUF1QixVQUFBQyxPQUFPO0FBQUEsV0FBSUEsT0FBTyxDQUFDTixLQUFSLEtBQWtCQSxLQUF0QjtBQUFBLEdBQTlCLENBQW5CLENBTGlDLENBT2pDO0FBQ0E7OztBQUNBLE1BQUlBLEtBQUosRUFBVztBQUNWO0FBQ0M7QUFDQU8sNkJBQUlDLE1BQUosQ0FBV1IsS0FBWCxFQUFrQlgsR0FBRyxDQUFDb0IsUUFBdEIsRUFBaUMsVUFBQ0MsR0FBRCxFQUFNQyxPQUFOLEVBQWlCO0FBQ2xEO0FBQ0UsVUFBSUQsR0FBSixFQUFTO0FBQ1I7QUFDQyxlQUFPWixHQUFHLENBQUNKLElBQUosQ0FBUztBQUNma0IsVUFBQUEsTUFBTSxFQUFFLEdBRE87QUFFbkJDLFVBQUFBLE9BQU8sRUFBRSxlQUZVO0FBR25CQyxVQUFBQSxJQUFJLEVBQUU7QUFFRkQsWUFBQUEsT0FBTyxFQUFFO0FBRlA7QUFIYSxTQUFULENBQVA7QUFNRCxPQVJELE1BUU87QUFDTixZQUFHWCxVQUFILEVBQWU7QUFDZCxjQUFNYSxjQUFjLEdBQUdaLGtCQUFNQyxXQUFOLENBQWtCQyxJQUFsQixDQUF1QixVQUFBQyxPQUFPO0FBQUEsbUJBQUlBLE9BQU8sQ0FBQ1UsRUFBUixLQUFlZCxVQUFVLENBQUNjLEVBQTlCO0FBQUEsV0FBOUIsQ0FBdkI7O0FBQ0NDLFVBQUFBLE9BQU8sQ0FBQ0MsR0FBUixDQUFZLGlCQUFlSCxjQUFjLENBQUNJLFFBQTFDOztBQUNELGNBQUdKLGNBQWMsQ0FBQ0ksUUFBZixLQUE0QixJQUEvQixFQUFvQztBQUNwQztBQUNBO0FBQ0F0QixZQUFBQSxHQUFHLENBQUNjLE9BQUosR0FBY0EsT0FBZDtBQUNBWixZQUFBQSxJQUFJO0FBQ0wsV0FMQyxNQU1HO0FBQ0gsbUJBQU9ELEdBQUcsQ0FBQ0osSUFBSixDQUFTO0FBQ2ZrQixjQUFBQSxNQUFNLEVBQUUsR0FETztBQUVsQkMsY0FBQUEsT0FBTyxFQUFFLG9CQUZTO0FBR2xCQyxjQUFBQSxJQUFJLEVBQUU7QUFFRkQsZ0JBQUFBLE9BQU8sRUFBRTtBQUZQO0FBSFksYUFBVCxDQUFQO0FBUUQ7QUFDRixTQW5CRSxNQW9CQztBQUVILGlCQUFPZixHQUFHLENBQUNKLElBQUosQ0FBUztBQUNaa0IsWUFBQUEsTUFBTSxFQUFFLEdBREk7QUFFZkMsWUFBQUEsT0FBTyxFQUFFLGdCQUZNO0FBR2ZDLFlBQUFBLElBQUksRUFBRTtBQUVGRCxjQUFBQSxPQUFPLEVBQUU7QUFGUDtBQUhTLFdBQVQsQ0FBUDtBQU9EO0FBRUc7QUFDRixLQTNDRDtBQTZDRCxHQWhERCxNQWdETztBQUVMO0FBRUFmLElBQUFBLEdBQUcsQ0FBQ3NCLElBQUosQ0FBUztBQUNSUixNQUFBQSxNQUFNLEVBQUUsR0FEQTtBQUVSQyxNQUFBQSxPQUFPLEVBQUUsb0JBRkQ7QUFHUkMsTUFBQUEsSUFBSSxFQUFFO0FBRUhELFFBQUFBLE9BQU8sRUFBRTtBQUZOO0FBSEUsS0FBVDtBQVFEO0FBQ0YsQ0F0RUgiLCJzb3VyY2VSb290IjoiL2hvbWUvbWhhc2hpbS9EZXNrdG9wL05ld1dvcmsvQXV0b01hcnQvc3JjL21pZGRsZXdhcmVzIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IGV4cHJlc3MgZnJvbSAnZXhwcmVzcyc7XG5pbXBvcnQgUmVmbGVjdGlvbiBmcm9tICcuLi9jb250cm9sbGVycy9SZWZsZWN0aW9uJztcbmltcG9ydCB1c2VyIGZyb20gJy4uL2NvbnRyb2xsZXJzL3VzZXInO1xuaW1wb3J0IGp3dCBmcm9tICdqc29ud2VidG9rZW4nO1xuaW1wb3J0IHVzZXJ4IGZyb20gJy4uL21vZGVscy91c2VyJztcbi8vaW1wb3J0IHRva2Vua2V5IGZyb20gJy4va2V5JztcblxuXG5jb25zdCBrZXkgPSByZXF1aXJlKCcuL2tleScpO1xuXG5jb25zdCBhcHAgPSBleHByZXNzKClcbmFwcC51c2UoZXhwcmVzcy5qc29uKCkpXG5cblxuXG4vL2FwcC51c2UoJy9hcGkvdjEvY2FyJywgUHJvdGVjdGVkUm91dGVzKTtcbm1vZHVsZS5leHBvcnRzID0gKHJlcSwgcmVzLCBuZXh0KSA9PiB7XG5cblxuICAgIC8vIGNoZWNrIGhlYWRlciBmb3IgdGhlIHRva2VuXG4gICAgdmFyIHRva2VuID0gcmVxLmhlYWRlcnNbJ2FjY2Vzcy10b2tlbiddO1xuICAgIGNvbnN0IHJlZmxlY3Rpb24gPSB1c2VyeC5yZWZsZWN0aW9ucy5maW5kKHJlZmxlY3QgPT4gcmVmbGVjdC50b2tlbiA9PT0gdG9rZW4pO1xuXG4gICAgLy9jb25zb2xlLmxvZyhcImlzX2FkbWluPT09XCIrcmVmbGVjdGlvbi5pZCk7XG4gICAgLy8gZGVjb2RlIHRva2VuXG4gICAgaWYgKHRva2VuKSB7XG4gICAgIC8vY29uc29sZS5sb2coa2V5LnRva2Vua2V5KVxuICAgICAgLy8gdmVyaWZpZXMgc2VjcmV0IGFuZCBjaGVja3MgaWYgdGhlIHRva2VuIGlzIGV4cGlyZWRcbiAgICAgIGp3dC52ZXJpZnkodG9rZW4sIGtleS50b2tlbmtleSAsIChlcnIsIGRlY29kZWQpID0+eyAgXG4gICAgICAvL2NvbnNvbGUubG9nKCctLS0tLS0tLS0tLS0tLS0tLS0tLS0tLScsZXJyKVxuICAgICAgICBpZiAoZXJyKSB7XG4gICAgICAgIFx0Ly9jb25zb2xlLmxvZyh0b2tlbik7XG4gICAgICAgICAgcmV0dXJuIHJlcy5qc29uKHsgXG4gICAgICAgICAgIHN0YXR1cyA6NDAwLFxuICAgICAgXHRtZXNzYWdlIDpcImludmFsaWQgdG9rZW5cIixcbiAgICAgIFx0ZGF0YTogeyAgXG5cbiAgICAgICAgICBcdG1lc3NhZ2U6ICdpbnZhbGlkIHRva2VuJyB9IH0pOyAgICBcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgIGlmKHJlZmxlY3Rpb24pIHtcbiAgICAgICAgICBjb25zdCByZWZsZWN0aW9udXNlciA9IHVzZXJ4LnJlZmxlY3Rpb25zLmZpbmQocmVmbGVjdCA9PiByZWZsZWN0LmlkID09PSByZWZsZWN0aW9uLmlkKTtcbiAgICAgICAgICAgY29uc29sZS5sb2coXCJpZmZmZmZmZmY9PSBcIityZWZsZWN0aW9udXNlci5pc19hZG1pbik7XG4gICAgICAgICAgaWYocmVmbGVjdGlvbnVzZXIuaXNfYWRtaW4gPT09IHRydWUpe1xuICAgICAgICAgIC8vICBjb25zb2xlLmxvZyhcImlzX2FkbWluPT09XCIrcmVmbGVjdGlvbik7XG4gICAgICAgICAgLy8gaWYgZXZlcnl0aGluZyBpcyBnb29kLCBzYXZlIHRvIHJlcXVlc3QgZm9yIHVzZSBpbiBvdGhlciByb3V0ZXNcbiAgICAgICAgICByZXEuZGVjb2RlZCA9IGRlY29kZWQ7ICAgIFxuICAgICAgICAgIG5leHQoKTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICByZXR1cm4gcmVzLmpzb24oeyBcbiAgICAgICAgICAgc3RhdHVzIDo0MDAsXG4gICAgICAgIG1lc3NhZ2UgOlwieW91ciBhcmUgbm90IGFkbWluXCIsXG4gICAgICAgIGRhdGE6IHsgIFxuXG4gICAgICAgICAgICBtZXNzYWdlOiAnIHlvdXIgYXJlIG5vdCBhZG1pbicgfSB9KTtcblxuXG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgZWxzZSB7XG5cbiAgICAgICByZXR1cm4gcmVzLmpzb24oeyBcbiAgICAgICAgICAgc3RhdHVzIDo0MDAsXG4gICAgICAgIG1lc3NhZ2UgOlwiVXNlciBub3QgRm91bmRcIixcbiAgICAgICAgZGF0YTogeyAgXG5cbiAgICAgICAgICAgIG1lc3NhZ2U6ICcgVXNlciBub3QgRm91bmQnIH0gfSk7XG5cbiAgICAgfVxuXG4gICAgICAgIH1cbiAgICAgIH0pO1xuXG4gICAgfSBlbHNlIHtcblxuICAgICAgLy8gaWYgdGhlcmUgaXMgbm8gdG9rZW4gIFxuXG4gICAgICByZXMuc2VuZCh7IFxuICAgICAgXHRzdGF0dXMgOjQwMSxcbiAgICAgIFx0bWVzc2FnZSA6XCJ0b2tlbiBub3QgcHJvdmlkZWRcIixcbiAgICAgIFx0ZGF0YTogeyAgXG5cbiAgICAgICAgICBtZXNzYWdlOiAnTm8gdG9rZW4gcHJvdmlkZWQuJ30gXG4gICAgICB9KTtcblxuICAgIH1cbiAgfTtcbiAiXX0=