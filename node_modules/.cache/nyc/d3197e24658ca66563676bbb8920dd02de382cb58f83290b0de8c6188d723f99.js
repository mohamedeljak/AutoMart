"use strict";var cov_1ml5jb7p6e=function(){var path="/home/mhashim/Desktop/NewWork/AutoMart/src/middlewares/authenticationMiddleware.js";var hash="1bd77153119a17340e10db0094860da04facaf7e";var global=new Function("return this")();var gcv="__coverage__";var coverageData={path:"/home/mhashim/Desktop/NewWork/AutoMart/src/middlewares/authenticationMiddleware.js",statementMap:{"0":{start:{line:3,column:15},end:{line:3,column:57}},"1":{start:{line:5,column:18},end:{line:5,column:78}},"2":{start:{line:7,column:12},end:{line:7,column:66}},"3":{start:{line:9,column:20},end:{line:9,column:67}},"4":{start:{line:11,column:39},end:{line:11,column:95}},"5":{start:{line:14,column:10},end:{line:14,column:26}},"6":{start:{line:16,column:10},end:{line:16,column:36}},"7":{start:{line:17,column:0},end:{line:17,column:36}},"8":{start:{line:19,column:0},end:{line:53,column:2}},"9":{start:{line:21,column:14},end:{line:21,column:41}},"10":{start:{line:23,column:2},end:{line:52,column:3}},"11":{start:{line:26,column:4},end:{line:42,column:7}},"12":{start:{line:28,column:6},end:{line:41,column:7}},"13":{start:{line:29,column:8},end:{line:29,column:27}},"14":{start:{line:30,column:8},end:{line:36,column:11}},"15":{start:{line:39,column:8},end:{line:39,column:30}},"16":{start:{line:40,column:8},end:{line:40,column:15}},"17":{start:{line:45,column:4},end:{line:51,column:7}}},fnMap:{"0":{name:"_interopRequireDefault",decl:{start:{line:11,column:9},end:{line:11,column:31}},loc:{start:{line:11,column:37},end:{line:11,column:97}},line:11},"1":{name:"(anonymous_1)",decl:{start:{line:19,column:17},end:{line:19,column:18}},loc:{start:{line:19,column:43},end:{line:53,column:1}},line:19},"2":{name:"(anonymous_2)",decl:{start:{line:26,column:57},end:{line:26,column:58}},loc:{start:{line:26,column:81},end:{line:42,column:5}},line:26}},branchMap:{"0":{loc:{start:{line:11,column:46},end:{line:11,column:94}},type:"cond-expr",locations:[{start:{line:11,column:70},end:{line:11,column:73}},{start:{line:11,column:76},end:{line:11,column:94}}],line:11},"1":{loc:{start:{line:11,column:46},end:{line:11,column:67}},type:"binary-expr",locations:[{start:{line:11,column:46},end:{line:11,column:49}},{start:{line:11,column:53},end:{line:11,column:67}}],line:11},"2":{loc:{start:{line:23,column:2},end:{line:52,column:3}},type:"if",locations:[{start:{line:23,column:2},end:{line:52,column:3}},{start:{line:23,column:2},end:{line:52,column:3}}],line:23},"3":{loc:{start:{line:28,column:6},end:{line:41,column:7}},type:"if",locations:[{start:{line:28,column:6},end:{line:41,column:7}},{start:{line:28,column:6},end:{line:41,column:7}}],line:28}},s:{"0":0,"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0},f:{"0":0,"1":0,"2":0},b:{"0":[0,0],"1":[0,0],"2":[0,0],"3":[0,0]},_coverageSchema:"43e27e138ebf9cfc5966b082cf9a028302ed4184",hash:"1bd77153119a17340e10db0094860da04facaf7e"};var coverage=global[gcv]||(global[gcv]={});if(coverage[path]&&coverage[path].hash===hash){return coverage[path];}return coverage[path]=coverageData;}();var _express=(cov_1ml5jb7p6e.s[0]++,_interopRequireDefault(require("express")));var _Reflection=(cov_1ml5jb7p6e.s[1]++,_interopRequireDefault(require("../controllers/Reflection")));var _user=(cov_1ml5jb7p6e.s[2]++,_interopRequireDefault(require("../controllers/user")));var _jsonwebtoken=(cov_1ml5jb7p6e.s[3]++,_interopRequireDefault(require("jsonwebtoken")));function _interopRequireDefault(obj){cov_1ml5jb7p6e.f[0]++;cov_1ml5jb7p6e.s[4]++;return(cov_1ml5jb7p6e.b[1][0]++,obj)&&(cov_1ml5jb7p6e.b[1][1]++,obj.__esModule)?(cov_1ml5jb7p6e.b[0][0]++,obj):(cov_1ml5jb7p6e.b[0][1]++,{"default":obj});}//import tokenkey from './key';
var key=(cov_1ml5jb7p6e.s[5]++,require('./key'));var app=(cov_1ml5jb7p6e.s[6]++,(0,_express["default"])());cov_1ml5jb7p6e.s[7]++;app.use(_express["default"].json());//app.use('/api/v1/car', ProtectedRoutes);
cov_1ml5jb7p6e.s[8]++;module.exports=function(req,res,next){cov_1ml5jb7p6e.f[1]++;// check header for the token
var token=(cov_1ml5jb7p6e.s[9]++,req.headers['access-token']);// decode token
cov_1ml5jb7p6e.s[10]++;if(token){cov_1ml5jb7p6e.b[2][0]++;cov_1ml5jb7p6e.s[11]++;//console.log(key.tokenkey)
// verifies secret and checks if the token is expired
_jsonwebtoken["default"].verify(token,key.tokenkey,function(err,decoded){cov_1ml5jb7p6e.f[2]++;cov_1ml5jb7p6e.s[12]++;//console.log('-----------------------',err)
if(err){cov_1ml5jb7p6e.b[3][0]++;cov_1ml5jb7p6e.s[13]++;console.log(token);cov_1ml5jb7p6e.s[14]++;return res.json({status:400,message:"invalid token",data:{message:'invalid token'}});}else{cov_1ml5jb7p6e.b[3][1]++;cov_1ml5jb7p6e.s[15]++;// if everything is good, save to request for use in other routes
req.decoded=decoded;cov_1ml5jb7p6e.s[16]++;next();}});}else{cov_1ml5jb7p6e.b[2][1]++;cov_1ml5jb7p6e.s[17]++;// if there is no token  
res.send({status:401,message:"token not provided",data:{message:'No token provided.'}});}};//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImF1dGhlbnRpY2F0aW9uTWlkZGxld2FyZS5qcyJdLCJuYW1lcyI6WyJrZXkiLCJyZXF1aXJlIiwiYXBwIiwidXNlIiwiZXhwcmVzcyIsImpzb24iLCJtb2R1bGUiLCJleHBvcnRzIiwicmVxIiwicmVzIiwibmV4dCIsInRva2VuIiwiaGVhZGVycyIsImp3dCIsInZlcmlmeSIsInRva2Vua2V5IiwiZXJyIiwiZGVjb2RlZCIsImNvbnNvbGUiLCJsb2ciLCJzdGF0dXMiLCJtZXNzYWdlIiwiZGF0YSIsInNlbmQiXSwibWFwcGluZ3MiOiI7O0FBQUE7O0FBQ0E7O0FBQ0E7O0FBQ0E7Ozs7QUFDQTtBQUdBLElBQU1BLEdBQUcsR0FBR0MsT0FBTyxDQUFDLE9BQUQsQ0FBbkI7O0FBRUEsSUFBTUMsR0FBRyxHQUFHLDBCQUFaO0FBQ0FBLEdBQUcsQ0FBQ0MsR0FBSixDQUFRQyxvQkFBUUMsSUFBUixFQUFSLEUsQ0FJQTs7QUFDQUMsTUFBTSxDQUFDQyxPQUFQLEdBQWlCLFVBQUNDLEdBQUQsRUFBTUMsR0FBTixFQUFXQyxJQUFYLEVBQW9CO0FBR2pDO0FBQ0EsTUFBSUMsS0FBSyxHQUFHSCxHQUFHLENBQUNJLE9BQUosQ0FBWSxjQUFaLENBQVosQ0FKaUMsQ0FNakM7O0FBQ0EsTUFBSUQsS0FBSixFQUFXO0FBQ1Y7QUFDQztBQUNBRSw2QkFBSUMsTUFBSixDQUFXSCxLQUFYLEVBQWtCWCxHQUFHLENBQUNlLFFBQXRCLEVBQWlDLFVBQUNDLEdBQUQsRUFBTUMsT0FBTixFQUFpQjtBQUNsRDtBQUNFLFVBQUlELEdBQUosRUFBUztBQUNSRSxRQUFBQSxPQUFPLENBQUNDLEdBQVIsQ0FBWVIsS0FBWjtBQUNDLGVBQU9GLEdBQUcsQ0FBQ0osSUFBSixDQUFTO0FBQ2ZlLFVBQUFBLE1BQU0sRUFBRSxHQURPO0FBRW5CQyxVQUFBQSxPQUFPLEVBQUUsZUFGVTtBQUduQkMsVUFBQUEsSUFBSSxFQUFFO0FBRUZELFlBQUFBLE9BQU8sRUFBRTtBQUZQO0FBSGEsU0FBVCxDQUFQO0FBTUQsT0FSRCxNQVFPO0FBQ0w7QUFDQWIsUUFBQUEsR0FBRyxDQUFDUyxPQUFKLEdBQWNBLE9BQWQ7QUFDQVAsUUFBQUEsSUFBSTtBQUNMO0FBQ0YsS0FmRDtBQWlCRCxHQXBCRCxNQW9CTztBQUVMO0FBRUFELElBQUFBLEdBQUcsQ0FBQ2MsSUFBSixDQUFTO0FBQ1JILE1BQUFBLE1BQU0sRUFBRSxHQURBO0FBRVJDLE1BQUFBLE9BQU8sRUFBRSxvQkFGRDtBQUdSQyxNQUFBQSxJQUFJLEVBQUU7QUFFSEQsUUFBQUEsT0FBTyxFQUFFO0FBRk47QUFIRSxLQUFUO0FBUUQ7QUFDRixDQXhDSCIsInNvdXJjZVJvb3QiOiIvaG9tZS9taGFzaGltL0Rlc2t0b3AvTmV3V29yay9BdXRvTWFydC9zcmMvbWlkZGxld2FyZXMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgZXhwcmVzcyBmcm9tICdleHByZXNzJztcbmltcG9ydCBSZWZsZWN0aW9uIGZyb20gJy4uL2NvbnRyb2xsZXJzL1JlZmxlY3Rpb24nO1xuaW1wb3J0IHVzZXIgZnJvbSAnLi4vY29udHJvbGxlcnMvdXNlcic7XG5pbXBvcnQgand0IGZyb20gJ2pzb253ZWJ0b2tlbic7XG4vL2ltcG9ydCB0b2tlbmtleSBmcm9tICcuL2tleSc7XG5cblxuY29uc3Qga2V5ID0gcmVxdWlyZSgnLi9rZXknKTtcblxuY29uc3QgYXBwID0gZXhwcmVzcygpXG5hcHAudXNlKGV4cHJlc3MuanNvbigpKVxuXG5cblxuLy9hcHAudXNlKCcvYXBpL3YxL2NhcicsIFByb3RlY3RlZFJvdXRlcyk7XG5tb2R1bGUuZXhwb3J0cyA9IChyZXEsIHJlcywgbmV4dCkgPT4ge1xuXG5cbiAgICAvLyBjaGVjayBoZWFkZXIgZm9yIHRoZSB0b2tlblxuICAgIHZhciB0b2tlbiA9IHJlcS5oZWFkZXJzWydhY2Nlc3MtdG9rZW4nXTtcblxuICAgIC8vIGRlY29kZSB0b2tlblxuICAgIGlmICh0b2tlbikge1xuICAgICAvL2NvbnNvbGUubG9nKGtleS50b2tlbmtleSlcbiAgICAgIC8vIHZlcmlmaWVzIHNlY3JldCBhbmQgY2hlY2tzIGlmIHRoZSB0b2tlbiBpcyBleHBpcmVkXG4gICAgICBqd3QudmVyaWZ5KHRva2VuLCBrZXkudG9rZW5rZXkgLCAoZXJyLCBkZWNvZGVkKSA9PnsgIFxuICAgICAgLy9jb25zb2xlLmxvZygnLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0nLGVycilcbiAgICAgICAgaWYgKGVycikge1xuICAgICAgICBcdGNvbnNvbGUubG9nKHRva2VuKTtcbiAgICAgICAgICByZXR1cm4gcmVzLmpzb24oeyBcbiAgICAgICAgICAgc3RhdHVzIDo0MDAsXG4gICAgICBcdG1lc3NhZ2UgOlwiaW52YWxpZCB0b2tlblwiLFxuICAgICAgXHRkYXRhOiB7ICBcblxuICAgICAgICAgIFx0bWVzc2FnZTogJ2ludmFsaWQgdG9rZW4nIH0gfSk7ICAgIFxuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIC8vIGlmIGV2ZXJ5dGhpbmcgaXMgZ29vZCwgc2F2ZSB0byByZXF1ZXN0IGZvciB1c2UgaW4gb3RoZXIgcm91dGVzXG4gICAgICAgICAgcmVxLmRlY29kZWQgPSBkZWNvZGVkOyAgICBcbiAgICAgICAgICBuZXh0KCk7XG4gICAgICAgIH1cbiAgICAgIH0pO1xuXG4gICAgfSBlbHNlIHtcblxuICAgICAgLy8gaWYgdGhlcmUgaXMgbm8gdG9rZW4gIFxuXG4gICAgICByZXMuc2VuZCh7IFxuICAgICAgXHRzdGF0dXMgOjQwMSxcbiAgICAgIFx0bWVzc2FnZSA6XCJ0b2tlbiBub3QgcHJvdmlkZWRcIixcbiAgICAgIFx0ZGF0YTogeyAgXG5cbiAgICAgICAgICBtZXNzYWdlOiAnTm8gdG9rZW4gcHJvdmlkZWQuJ30gXG4gICAgICB9KTtcblxuICAgIH1cbiAgfTtcbiAiXX0=